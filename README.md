# Тестовое задание

**Автор**: Стремин Валентин (supchaser)

**tg**: @supchs

**Дата получения тестового задания:** 29.07.2025

**Дата сдачи тестового задания:** 31.07.2025

## Условие

Необходимо написать систему, в которой пользователь может отправлять запрос в котором будут содержаться ссылки на картинки или файлы, в открытом доступе в интернете, которые необходимо будет скачать и запаковать в zip архив и вернуть пользователю. В случае недоступности какого-либо ресурса по ссылке, пользователю в ответе сервера нужно будет об этом сообщить, но все остальные объекты по ссылкам все равно запаковать в архив и вернуть.

Нужно настроить ограничение по работе с объектами, не больше 3 объектов, а так же, фильтрацию типов объектов, это могут быть .pdf и .jpeg.

С помощью отдельного метода API пользователь может создавать задачу на создание архива. Другим методом API он может добавлять в эту задачу ссылки на файлы которые будут в архиве. По каждой задаче, пользователь должен уметь получить ее статус. Как только число добавляемых файлов в задачу будет равно трем, метод получения статуса должен, вместе со статусом, вернуть ссылку на архив. 
Одновременно программа может работать только над тремя задачами по созданию архива. Если пользователь создает новую задачу, а в работе уже есть 3 архива, пользователь должен получить ответ, о том что сервер в данный момент занят.

Нельзя использовать внешнюю инфраструктуру: докер, БД, и др. Можно использовать конфигурацию для управления доступными расширениями, конфигурированием порта и др. Можно и даже нужно пользоваться стандартными практиками и паттернами, которые желательно описать в readme.md файле. Помни, все, что сгенерировано нейросетью очень выделяется по сравнению с кодом, который человек пишет сам.
Сервер должен запускаться на порту 8080.

Предварительно убедись в работоспособности кода, и если возникают моменты, которые необходимо дополнительно сообщить, опиши их в readme.md Помни, на оценку задачи уходит лимитированное количество времени и сложности с запуском кода влекут за собой снижение итогового балла.

В качестве решения нужно прислать ссылку на репозиторий, репозиторий называешь по текущей дате без упоминания workmate.

## Решение

### Архитектура проекта

- Чистая архитектура с разделением на слои:
```
    cmd/            → Точка входа (main)
    internal/
    app/            → Ядро приложения
        delivery/   → Хэндлеры
        usecase/    → Бизнес-логика
        repository/ → Хранилище (in-memory)
    config/         → Конфигурация
    middleware/     → Мидлвари
    utils/          → Вспомогательные утилиты
```

### Описание API

1. Создание задачи

- `POST /api/v1/tasks`
- Ответ:
```.json
{
	"ID": {{id}},
	"Status": "waiting",
	"Objects": [],
	"CreatedAt": "2025-07-31T11:17:18.650814493+03:00"
}
``` 

2. Добавление объекта в задачу

- `POST /api/v1/tasks/{id}/objects`
- Тело запроса (максимум три объекта):
```
{
    "urls": [
        "https://samplelib.com/lib/preview/jpeg/sample-clouds-400x300.jpg",
        "https://in-new.ru/public/documents/test.pdf",
        "https://abc-profmed.ru/g/s3/lp/lpc.v4/file/TestPDF.pdf"
    ]
}
```

- Ответ:
```
{
	"added_count": 3,
	"failed_urls": {},
	"total_objects": 3
}
```

- Если задача уже содержит три объекта, то получим такой ответ:
```
{
	"added_count": 0,
	"failed_urls": {
		"https://example.com/test.pdf": "maximum objects per task reached"
	},
	"total_objects": 3
}
```

- Если объект недоступен по данной ссылке:

Пример тела запроса:
```
{
    "urls": [
        "https://example.com/test.pdf"
    ]
}
```

Ответ:
```
{
	"added_count": 0,
	"failed_urls": {
		"https://example.com/test.pdf": "file is unavailable"
	},
	"total_objects": 0
}
```

3. Получить все задачи

- `GET /api/v1/tasks`
- Ответ:
```
{
	"count": 3,
	"tasks": [
		{
			"id": {id},
			"status": "done",
			"created_at": "2025-07-31T11:17:18.650814493+03:00",
			"objects_count": 3
		},
		{
			"id": {id},
			"status": "waiting",
			"created_at": "2025-07-31T11:21:17.930180385+03:00",
			"objects_count": 1
		},
		{
			"id": {id},
			"status": "done",
			"created_at": "2025-07-31T11:21:58.592552914+03:00",
			"objects_count": 3
		}
	]
}
```

4. Получить одну задачу по ID

- `GET /api/v1/tasks/{id}` 
- Ответ:
```
{
	"ID": {id},
	"Status": "done",
	"Objects": [
		{
			"ID": {id},
			"URL": "https://in-new.ru/public/documents/test.pdf",
			"Error": ""
		},
		{
			"ID": {id},
			"URL": "https://in-new.ru/public/documents/test.pdf",
			"Error": ""
		},
		{
			"ID": {id},
			"URL": "https://in-new.ru/public/documents/test.pdf",
			"Error": ""
		}
	],
	"CreatedAt": "2025-07-31T11:17:18.650814493+03:00"
}
```

5. Получить статус задачи:
 
- `GET /api/v1/tasks/{id}/status` 
- Ответ:
```
{
	"status": "done",
	"zip_url": "/download/{id}"
}
``` 

6. Скачать архив

- `GET /api/v1/tasks/{id}/archive`
- Ответ: архив скачивается

Если архив еще не готов для скачивания:
```
{
	"status": 404,
	"text": "archive not ready"
}
```

### Настройка окружения

**Пример файла .env:**

```.env
LOG_MODE="dev"
SERVER_PORT="8080"
MAX_ACTIVE_TASKS="3"
```

### Некоторые команды по работе с проектом

`make run` - запуск программы
`make test` - запуск тестов
``
### Тестирование

- ~70% покрытия юнит тестами;
- для тестирования использовался инструмент `gomock`.
